swagger: '2.0'
info:
  version: 1.0.1-rev-28
  title: International Tracked Direct API
  description: >-
    International Tracked Direct API V1 provides the integration method to Royal
    Mail business customers for using Royal Mail's international tracked direct
    service. This API offers the capability of creation and cancellation of an
    international shipment, getting bag label(s) and manifest and tracking
    international tracked direct shipments.



    Built on industry standards, International Tracked Direct API V1 provides
    a simple and low cost method for customers to integrate with Royal Mail, and
    allows them to get international shipping quickly.



    There are no costs to customers for using the International Tracked Direct
    API V1, however customersâ€™ own development costs must be covered by the
    customer developing the solution. Royal Mail will not accept any
    responsibility for these development, implementation and testing costs.



    Customers should address initial enquiries regarding development of systems
    for these purposes to their account handler.
  x-ibm-name: international-tracked-direct-api
basePath: /international/shipment/v2
schemes:
  - https
x-ibm-configuration:
  enforced: true
  phase: realized
  testable: true
  cors:
    enabled: true
  properties:
    ApplicationId:
      value: 0703386001
      description: Application Id For BIG
      encoded: false
    Tracking SSL Profile:
      description: SSL profile of the underlying IEDE API
      encoded: false
      value: onboarding-pre-prod-test-ca2
    activity.log.level:
      description: What to log for activity logging
      encoded: false
      value: payload
    error.log.level:
      description: What to log for error logging
      encoded: false
      value: payload
    IEDE Endpoint:
      description: 'IEDE API endpoint '
      encoded: false
      value: 'https://sit-api.royalmail.com/international/shipment/v1'
  catalogs: {}
  externalDocs: []
  attachments:
    - title: RMG International Tracked Direct API(REST) Technical User Guide
      description: ''
      id: 58246cc30cf26ff86d3beed2
    - title: International Tracked Direct API SampleData
      description: ''
      id: 58246cc60cf26ff86d3beed8
    - title: International Tracked Direct API XSDs
      description: ''
      id: 58246cc60cf26ff86d3beede
  gateway: datapower-gateway
  assembly:
    execute:
      - operation-switch:
          title: operation-switch
          case:
            - operations:
                - verb: delete
                  path: '/{trackingNumber}'
              execute:
                - map:
                    inputs:
                      in1:
                        variable: request.parameters
                        schema:
                          type: object
                          properties:
                            trackingNumber:
                              type: string
                      rmg_headers:
                        schema:
                          type: object
                          properties:
                            X-RMG-Password:
                              type: password
                            X-RMG-Nonce:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                            X-RMG-User-Name:
                              type: string
                        variable: request.headers
                    outputs:
                      out1:
                        variable: message.body
                        schema:
                          type: object
                          properties:
                            trackingNumber:
                              type: string
                        content: application/xml
                      RMG_headers:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    actions:
                      - set: out1.trackingNumber
                        from: in1.trackingNumber
                      - set: RMG_headers.X-RMG-Transaction-Id
                        from: rmg_headers.X-RMG-Nonce
                      - set: RMG_headers.X-RMG-Date-Time
                        from: rmg_headers.X-RMG-Date-Time
                    options:
                      inlineNamespaces: false
                      includeEmptyXMLElements: false
                    title: cancelShipmentMap
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: "apim.setvariable('message.headers.X-RMG-Nonce',undefined);\n\n\nvar Count = apim.getvariable('message.headers.X-RMG-Transaction-Id');  \n\nif(Count != undefined ){\n \n    var Base64 = {\n\n\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\t\n\t\n\tdecode: function(input) {\n        var output = \"\";\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n        while (i < input.length) {\n\n            enc1 = this._keyStr.indexOf(input.charAt(i++));\n            enc2 = this._keyStr.indexOf(input.charAt(i++));\n            enc3 = this._keyStr.indexOf(input.charAt(i++));\n            enc4 = this._keyStr.indexOf(input.charAt(i++)); \n\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n\n            output = output + String.fromCharCode(chr1);\n\n            if (enc3 != 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 != 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n\n        }\n\n        output = Base64._utf8_decode(output);\n\n        return output;\n\n    },\n\t\n\t\n\t _utf8_decode: function(utftext) {\n        var string = \"\";\n        var i = 0;\n        var c = 0;\n        var c1 = 0;\n        var c2 = 0;\n        var c3 = 0;\n\n        while (i < utftext.length) {\n\n            c = utftext.charCodeAt(i); \n\n            if (c < 128) {\n                string += String.fromCharCode(c);\n                i++;\n            }\n            else if ((c > 191) && (c < 224)) {\n                c2 = utftext.charCodeAt(i + 1);\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                i += 2;\n            }\n            else {\n                c2 = utftext.charCodeAt(i + 1);\n                c3 = utftext.charCodeAt(i + 2);\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                i += 3;\n            }\n\n        }\n\n        return string;\n    }\n\n}\n\n var input_Out = Base64.decode(Count);\n \nfunction bytes (str) {\n  var bytes=0, len=str.length, codePoint, next, i;\n\n  for (i=0; i < len; i++) {\n    codePoint = str.charCodeAt(i); \n\n    // Lone surrogates cannot be passed to encodeURI\n    if (codePoint >= 0xD800 && codePoint < 0xE000) {\n      if (codePoint < 0xDC00 && i + 1 < len) {\n        next = str.charCodeAt(i + 1);\n\n        if (next >= 0xDC00 && next < 0xE000) {\n          bytes += 4;\n          i++;\n          continue;\n        }\n      }\n    } \n\n    bytes += (codePoint < 0x80 ? 1 : (codePoint < 0x800 ? 2 : 3));\n  }\n\n  return bytes;\n}\n\nvar in_1 = bytes(input_Out);\n\n if(in_1 < 17 ) \n {\napim.setvariable('message.headers.X-RMG-Transaction-Id',input_Out);\n \n }\n else\n {\n  apim.error('E0014', 400, 'Bad Request', 'Invalid Transaction-Id provided in API request');\n }\n \n }\n \n\n"
                - map:
                    inputs:
                      in1:
                        variable: request.parameters
                        schema:
                          type: object
                          properties:
                            trackingNumber:
                              type: string
                      input:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    outputs:
                      out1:
                        variable: message.body
                        schema:
                          type: object
                          properties:
                            cancelShipmentRequest:
                              type: object
                              properties:
                                integrationHeader:
                                  type: object
                                  properties:
                                    dateTime:
                                      type: string
                                      default: $(system.datetime)
                                    applicationId:
                                      type: string
                                      default: $(api.properties.ApplicationId)
                                    transactionId:
                                      type: string
                                      default: $(request.headers.x-rmg-transaction-id)
                                cancel:
                                  type: object
                                  properties:
                                    trackingNumber:
                                      type: string
                              xml:
                                namespace: 'http://www.royalmailgroup.com/api/international/shipment/V1'
                                prefix: p0
                        content: application/xml
                    actions:
                      - set: out1.cancelShipmentRequest.cancel.trackingNumber
                        from: in1.trackingNumber
                      - set: out1.cancelShipmentRequest.integrationHeader.applicationId
                        default: $(api.properties.ApplicationId)
                      - set: out1.cancelShipmentRequest.integrationHeader.transactionId
                        from: input.X-RMG-Transaction-Id
                      - set: out1.cancelShipmentRequest.integrationHeader.dateTime
                        from: input.X-RMG-Date-Time
                    options:
                      inlineNamespaces: false
                      includeEmptyXMLElements: false
                    title: cancelShipmentMap
                - invoke:
                    timeout: 60
                    verb: POST
                    target-url: $(IEDE Endpoint)
                    tls-profile: $(Tracking SSL Profile)
                    cache-response: protocol
                    cache-key: ''
                    title: cancelShipmentInvoke
                    output: Response
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: " var Response_1 = apim.getvariable('Response.body');\n \n apim.setvariable('message.body',Response_1);"
            - operations:
                - verb: get
                  path: '/{trackingNumber}/history'
              execute:
                - map:
                    inputs:
                      in1:
                        variable: request.parameters
                        schema:
                          type: object
                          properties:
                            trackingNumber:
                              type: string
                      rmg_headers:
                        schema:
                          type: object
                          properties:
                            X-RMG-Password:
                              type: string
                            X-RMG-Nonce:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                            X-RMG-User-Name:
                              type: string
                        variable: request.headers
                    outputs:
                      out1:
                        variable: message.body
                        schema:
                          type: object
                          properties:
                            trackingNumber:
                              type: string
                        content: application/xml
                      out2:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    actions:
                      - set: out1.trackingNumber
                        from: in1.trackingNumber
                      - set: out2.X-RMG-Transaction-Id
                        from: rmg_headers.X-RMG-Nonce
                      - set: out2.X-RMG-Date-Time
                        from: rmg_headers.X-RMG-Date-Time
                    options:
                      inlineNamespaces: false
                      includeEmptyXMLElements: false
                    title: trackingMap
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: "apim.setvariable('message.headers.X-RMG-Nonce',undefined);\n\nvar Count = apim.getvariable('message.headers.X-RMG-Transaction-Id');  \n\nif(Count != undefined ){\n \n    var Base64 = {\n\n\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\t\n\t\n\tdecode: function(input) {\n        var output = \"\";\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n        while (i < input.length) {\n\n            enc1 = this._keyStr.indexOf(input.charAt(i++));\n            enc2 = this._keyStr.indexOf(input.charAt(i++));\n            enc3 = this._keyStr.indexOf(input.charAt(i++));\n            enc4 = this._keyStr.indexOf(input.charAt(i++)); \n\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n\n            output = output + String.fromCharCode(chr1);\n\n            if (enc3 != 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 != 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n\n        }\n\n        output = Base64._utf8_decode(output);\n\n        return output;\n\n    },\n\t\n\t\n\t _utf8_decode: function(utftext) {\n        var string = \"\";\n        var i = 0;\n        var c = 0;\n        var c1 = 0;\n        var c2 = 0;\n        var c3 = 0;\n\n        while (i < utftext.length) {\n\n            c = utftext.charCodeAt(i); \n\n            if (c < 128) {\n                string += String.fromCharCode(c);\n                i++;\n            }\n            else if ((c > 191) && (c < 224)) {\n                c2 = utftext.charCodeAt(i + 1);\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                i += 2;\n            }\n            else {\n                c2 = utftext.charCodeAt(i + 1);\n                c3 = utftext.charCodeAt(i + 2);\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                i += 3;\n            }\n\n        }\n\n        return string;\n    }\n\n}\n\n var input_Out = Base64.decode(Count);\n \nfunction bytes (str) {\n  var bytes=0, len=str.length, codePoint, next, i;\n\n  for (i=0; i < len; i++) {\n    codePoint = str.charCodeAt(i); \n\n    // Lone surrogates cannot be passed to encodeURI\n    if (codePoint >= 0xD800 && codePoint < 0xE000) {\n      if (codePoint < 0xDC00 && i + 1 < len) {\n        next = str.charCodeAt(i + 1);\n\n        if (next >= 0xDC00 && next < 0xE000) {\n          bytes += 4;\n          i++;\n          continue;\n        }\n      }\n    } \n\n    bytes += (codePoint < 0x80 ? 1 : (codePoint < 0x800 ? 2 : 3));\n  }\n\n  return bytes;\n}\n\nvar in_1 = bytes(input_Out);\n\n if(in_1 < 17 ) \n {\napim.setvariable('message.headers.X-RMG-Transaction-Id',input_Out);\n \n }\n else\n {\n  apim.error('E0014', 400, 'Bad Request', 'Invalid Transaction-Id provided in API request');\n }\n \n }\n \n\n"
                - map:
                    inputs:
                      in1:
                        variable: request.parameters
                        schema:
                          type: object
                          properties:
                            trackingNumber:
                              type: string
                      input:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    outputs:
                      out1:
                        variable: message.body
                        schema:
                          type: object
                          properties:
                            trackingRequest:
                              type: object
                              properties:
                                integrationHeader:
                                  type: object
                                  properties:
                                    dateTime:
                                      type: string
                                      default: $(system.datetime)
                                    applicationId:
                                      type: string
                                      default: $(request.headers.x-rmg-application-id)
                                    transactionId:
                                      type: string
                                      default: $(request.headers.x-rmg-transaction-id)
                                trackingNumber:
                                  type: string
                              xml:
                                namespace: 'http://www.royalmailgroup.com/api/international/shipment/V1'
                                prefix: p0
                        content: application/xml
                    actions:
                      - set: out1.trackingRequest.trackingNumber
                        from: in1.trackingNumber
                      - set: out1.trackingRequest.integrationHeader.applicationId
                        default: $(api.properties.ApplicationId)
                      - set: out1.trackingRequest.integrationHeader.dateTime
                        from: input.X-RMG-Date-Time
                      - set: out1.trackingRequest.integrationHeader.transactionId
                        from: input.X-RMG-Transaction-Id
                    options:
                      inlineNamespaces: false
                      includeEmptyXMLElements: false
                    title: trackingMap
                - invoke:
                    timeout: 60
                    verb: POST
                    target-url: $(IEDE Endpoint)
                    tls-profile: $(Tracking SSL Profile)
                    title: trackingInvoke
                    output: Response
                    cache-response: protocol
                    cache-key: '900'
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: " var Response_1 = apim.getvariable('Response.body');\n \n apim.setvariable('message.body',Response_1);"
            - operations:
                - verb: post
                  path: /bagcontent
              execute:
                - map:
                    title: createBagMap
                    inputs:
                      body:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createBagRequest:
                              type: object
                              properties:
                                bagContent:
                                  type: object
                                  properties:
                                    confirmType:
                                      type: string
                                    carrierCode:
                                      type: string
                                    trackingNumber:
                                      type: array
                                      items:
                                        type: string
                                  xml:
                                    namespace: ''
                                numberOfBagLabels:
                                  type: string
                                labelType:
                                  type: string
                              xml:
                                namespace: ''
                          xml:
                            namespace: ''
                          example: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<createBagRequest>\r\n  <bagContent>\r\n    <confirmType>1</confirmType>\r\n\t<carrierCode>SSYD</carrierCode>\r\n    <trackingNumber>TES100644101000930203</trackingNumber>\r\n\t<trackingNumber>TES100644101000930203</trackingNumber>\r\n\t<trackingNumber>TES100644101000930203</trackingNumber>\r\n  </bagContent>\r\n  <numberOfBagLabels>1</numberOfBagLabels>\r\n  <labelType>PDF</labelType>\r\n</createBagRequest>"
                        variable: request.body
                        content: application/xml
                      rmg_headers:
                        schema:
                          type: object
                          properties:
                            X-RMG-Password:
                              type: string
                            X-RMG-Nonce:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                            X-RMG-User-Name:
                              type: string
                        variable: request.headers
                    outputs:
                      bigRequest:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createBagRequest:
                              type: object
                              properties:
                                bagContent:
                                  type: object
                                  properties:
                                    confirmType:
                                      type: string
                                    carrierCode:
                                      type: string
                                    trackingNumber:
                                      type: array
                                      items:
                                        type: string
                                  xml:
                                    namespace: ''
                                numberOfBagLabels:
                                  type: string
                                labelType:
                                  type: string
                              xml:
                                namespace: ''
                          xml:
                            namespace: ''
                          example: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<createBagRequest>\r\n  <bagContent>\r\n    <confirmType>1</confirmType>\r\n\t<carrierCode>SSYD</carrierCode>\r\n    <trackingNumber>TES100644101000930203</trackingNumber>\r\n\t<trackingNumber>TES100644101000930203</trackingNumber>\r\n\t<trackingNumber>TES100644101000930203</trackingNumber>\r\n  </bagContent>\r\n  <numberOfBagLabels>1</numberOfBagLabels>\r\n  <labelType>PDF</labelType>\r\n</createBagRequest>"
                        variable: message.body
                        content: application/xml
                      output1:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    actions:
                      - set: bigRequest.createBagRequest.bagContent.confirmType
                        from: body.createBagRequest.bagContent.confirmType
                      - set: bigRequest.createBagRequest.bagContent.carrierCode
                        from: body.createBagRequest.bagContent.carrierCode
                      - set: bigRequest.createBagRequest.numberOfBagLabels
                        from: body.createBagRequest.numberOfBagLabels
                      - set: bigRequest.createBagRequest.labelType
                        from: body.createBagRequest.labelType
                      - set: output1.X-RMG-Transaction-Id
                        from: rmg_headers.X-RMG-Nonce
                      - set: output1.X-RMG-Date-Time
                        from: rmg_headers.X-RMG-Date-Time
                      - create: bigRequest.createBagRequest.bagContent.trackingNumber
                        foreach: body.createBagRequest.bagContent.trackingNumber
                        from: body.createBagRequest.bagContent.trackingNumber
                        actions:
                          - set: $item
                            from: $item
                    version: 1.0.0
                    options:
                      includeEmptyXMLElements: false
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: "apim.setvariable('message.headers.X-RMG-Nonce',undefined);\n\nvar Count = apim.getvariable('message.headers.X-RMG-Transaction-Id');  \n\nif(Count != undefined ){\n \n    var Base64 = {\n\n\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\t\n\t\n\tdecode: function(input) {\n        var output = \"\";\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n        while (i < input.length) {\n\n            enc1 = this._keyStr.indexOf(input.charAt(i++));\n            enc2 = this._keyStr.indexOf(input.charAt(i++));\n            enc3 = this._keyStr.indexOf(input.charAt(i++));\n            enc4 = this._keyStr.indexOf(input.charAt(i++)); \n\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n\n            output = output + String.fromCharCode(chr1);\n\n            if (enc3 != 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 != 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n\n        }\n\n        output = Base64._utf8_decode(output);\n\n        return output;\n\n    },\n\t\n\t\n\t _utf8_decode: function(utftext) {\n        var string = \"\";\n        var i = 0;\n        var c = 0;\n        var c1 = 0;\n        var c2 = 0;\n        var c3 = 0;\n\n        while (i < utftext.length) {\n\n            c = utftext.charCodeAt(i); \n\n            if (c < 128) {\n                string += String.fromCharCode(c);\n                i++;\n            }\n            else if ((c > 191) && (c < 224)) {\n                c2 = utftext.charCodeAt(i + 1);\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                i += 2;\n            }\n            else {\n                c2 = utftext.charCodeAt(i + 1);\n                c3 = utftext.charCodeAt(i + 2);\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                i += 3;\n            }\n\n        }\n\n        return string;\n    }\n\n}\n\n var input_Out = Base64.decode(Count);\n \nfunction bytes (str) {\n  var bytes=0, len=str.length, codePoint, next, i;\n\n  for (i=0; i < len; i++) {\n    codePoint = str.charCodeAt(i); \n\n    // Lone surrogates cannot be passed to encodeURI\n    if (codePoint >= 0xD800 && codePoint < 0xE000) {\n      if (codePoint < 0xDC00 && i + 1 < len) {\n        next = str.charCodeAt(i + 1);\n\n        if (next >= 0xDC00 && next < 0xE000) {\n          bytes += 4;\n          i++;\n          continue;\n        }\n      }\n    } \n\n    bytes += (codePoint < 0x80 ? 1 : (codePoint < 0x800 ? 2 : 3));\n  }\n\n  return bytes;\n}\n\nvar in_1 = bytes(input_Out);\n\n if(in_1 < 17 ) \n {\napim.setvariable('message.headers.X-RMG-Transaction-Id',input_Out);\n \n }\n else\n {\n  apim.error('E0014', 400, 'Bad Request', 'Invalid Transaction-Id provided in API request');\n }\n \n }\n \n\n"
                - map:
                    title: createBagMap
                    inputs:
                      body:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createBagRequest:
                              type: object
                              properties:
                                bagContent:
                                  type: object
                                  properties:
                                    confirmType:
                                      type: string
                                    carrierCode:
                                      type: string
                                    trackingNumber:
                                      type: array
                                      items:
                                        type: string
                                  xml:
                                    namespace: ''
                                numberOfBagLabels:
                                  type: string
                                labelType:
                                  type: string
                              xml:
                                namespace: ''
                          xml:
                            namespace: ''
                          example: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<createBagRequest>\r\n  <bagContent>\r\n    <confirmType>1</confirmType>\r\n\t<carrierCode>SSYD</carrierCode>\r\n    <trackingNumber>TES100644101000930203</trackingNumber>\r\n\t<trackingNumber>TES100644101000930203</trackingNumber>\r\n\t<trackingNumber>TES100644101000930203</trackingNumber>\r\n  </bagContent>\r\n  <numberOfBagLabels>1</numberOfBagLabels>\r\n  <labelType>PDF</labelType>\r\n</createBagRequest>"
                        variable: message.body
                        content: application/xml
                      input:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    outputs:
                      bigRequest:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createBagRequest:
                              type: object
                              properties:
                                integrationHeader:
                                  type: object
                                  properties:
                                    dateTime:
                                      type: string
                                    applicationId:
                                      type: string
                                    transactionId:
                                      type: string
                                bagContent:
                                  type: object
                                  properties:
                                    confirmType:
                                      type: string
                                    carrierCode:
                                      type: string
                                    trackingNumber:
                                      type: array
                                      items:
                                        type: string
                                numberOfBagLabels:
                                  type: string
                                labelType:
                                  type: string
                                schemaLocation:
                                  type: string
                                  xml:
                                    attribute: true
                                    prefix: xsi
                              xml:
                                namespace: 'http://www.royalmailgroup.com/api/international/shipment/V1'
                                prefix: ns
                          xml:
                            namespace: ''
                          example: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<ns:createBagRequest xmlns:dt=\"http://www.royalmailgroup.com/cm/rmDatatypes/V1\" xmlns:int=\"http://www.royalmailgroup.com/integration/core/V3\" xmlns:ns=\"http://www.royalmailgroup.com/api/international/shipment/V1\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.royalmailgroup.com/api/international/shipment/V1/InternationalShippingAPI_V1_APIM.xsd \">\r\n    <ns:integrationHeader>\r\n      <ns:dateTime>2017-04-25T10:04:50</ns:dateTime>\r\n      <ns:applicationId>0703386001</ns:applicationId>\r\n      <ns:transactionId>8861474354</ns:transactionId>      \r\n  </ns:integrationHeader>\r\n  <ns:bagContent>\r\n    <ns:confirmType>1</ns:confirmType>\r\n    <ns:carrierCode>SSYD</ns:carrierCode>\r\n    <ns:trackingNumber>TES100917601000935008</ns:trackingNumber>\r\n    <ns:trackingNumber>123</ns:trackingNumber>\r\n     <ns:trackingNumber>1234</ns:trackingNumber>\r\n  </ns:bagContent>\r\n  <ns:numberOfBagLabels>1</ns:numberOfBagLabels>\r\n  <ns:labelType>PDF</ns:labelType>\r\n</ns:createBagRequest>"
                        variable: message.body
                        content: application/xml
                    actions:
                      - set: bigRequest.createBagRequest.bagContent.confirmType
                        from: body.createBagRequest.bagContent.confirmType
                      - set: bigRequest.createBagRequest.numberOfBagLabels
                        from: body.createBagRequest.numberOfBagLabels
                      - set: bigRequest.createBagRequest.labelType
                        from: body.createBagRequest.labelType
                      - create: bigRequest.createBagRequest.bagContent.trackingNumber
                        foreach: body.createBagRequest.bagContent.trackingNumber
                        from: body.createBagRequest.bagContent.trackingNumber
                        actions:
                          - set: $item
                            from: $item
                      - set: bigRequest.createBagRequest.integrationHeader.applicationId
                        default: $(api.properties.ApplicationId)
                      - set: bigRequest.createBagRequest.integrationHeader.transactionId
                        from: input.X-RMG-Transaction-Id
                      - set: bigRequest.createBagRequest.integrationHeader.dateTime
                        from: input.X-RMG-Date-Time
                      - set: bigRequest.createBagRequest.bagContent.carrierCode
                        from: body.createBagRequest.bagContent.carrierCode
                    version: 1.0.0
                    options:
                      includeEmptyXMLElements: false
                - invoke:
                    title: createBagInvoke
                    timeout: 60
                    verb: POST
                    cache-response: protocol
                    cache-ttl: 900
                    version: 1.0.0
                    tls-profile: onboarding-pre-prod-test-ca2
                    target-url: 'https://sit-api.royalmail.com/international/shipment/v1'
                    output: Response
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: " var Response_1 = apim.getvariable('Response.body');\n\n \n apim.setvariable('message.body',Response_1);"
            - operations:
                - verb: post
                  path: /
              execute:
                - map:
                    title: createShipmentMap
                    inputs:
                      input:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createShipmentRequest:
                              type: object
                              properties:
                                shipment:
                                  type: object
                                  properties:
                                    shipper:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        addressLine2:
                                          type: string
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                        reference:
                                          type: string
                                      xml:
                                        namespace: ''
                                    destination:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                      xml:
                                        namespace: ''
                                    shipmentDetail:
                                      type: object
                                      properties:
                                        shipmentDate:
                                          type: string
                                        serviceCode:
                                          type: string
                                        totalPieces:
                                          type: string
                                        totalWeight:
                                          type: string
                                        weightUOM:
                                          type: string
                                        dimensions:
                                          type: object
                                          properties:
                                            uom:
                                              type: string
                                            length:
                                              type: string
                                            width:
                                              type: string
                                            height:
                                              type: string
                                          xml:
                                            namespace: ''
                                        contentTypeCode:
                                          type: string
                                        descriptionOfGoods:
                                          type: string
                                        declaredCurrencyValue:
                                          type: string
                                        declaredCurrencyCode:
                                          type: string
                                        incotermsCode:
                                          type: string
                                        itemDetail:
                                          type: array
                                          items:
                                            properties:
                                              hsCode:
                                                type: string
                                              description:
                                                type: string
                                              quantity:
                                                type: string
                                              currencyValue:
                                                type: string
                                              countryOfOrigin:
                                                type: string
                                              sku:
                                                type: string
                                              netWeight:
                                                type: string
                                            type: object
                                            xml:
                                              namespace: ''
                                      xml:
                                        namespace: ''
                                  xml:
                                    namespace: ''
                              xml:
                                namespace: ''
                          xml:
                            namespace: ''
                          example: "<createShipmentRequest>\r\n  <shipment>\r\n    <shipper>\r\n      <companyName>INTERSOFT</companyName>\r\n      <addressLine1>THE MILL STUDIO</addressLine1>\r\n      <addressLine2>HORTON ROAD</addressLine2>\r\n      <addressLine3></addressLine3>\r\n      <city>STANWELL MOOR</city>\r\n      <county>MIDX</county>\r\n      <countryCode>GB</countryCode>\r\n      <postCode>TW19 6BJ</postCode>\r\n      <contactName>ARNOLD</contactName>\r\n      <phoneNumber>017536892921234567891</phoneNumber>\r\n      <vatNumber>GB123456912345678</vatNumber>\r\n      <emailAddress>SUPPORT@INTERSOFT.CO.UK</emailAddress>\r\n      <reference>INPSAUSSSYD</reference>\r\n      <departmentCode></departmentCode>\r\n    </shipper>\r\n    <destination>\r\n      <companyName>12345678901234567890123456789012345</companyName>\r\n      <addressLine1>11 Town Terrace</addressLine1>\r\n      <addressLine2></addressLine2>\r\n      <addressLine3></addressLine3>\r\n      <city>Glenmore Park</city>\r\n      <county>NSW</county>\r\n      <countryCode>AU</countryCode>\r\n      <postCode>2745</postCode>\r\n      <contactName>ARNOLD</contactName>\r\n      <phoneNumber>1545554455</phoneNumber>\r\n      <vatNumber>GB123456912345678</vatNumber>\r\n      <emailAddress>arnold.christian@intersoft.co.uk</emailAddress>\r\n    </destination>\r\n    <shipmentDetail>\r\n      <shipmentDate>2011-07-14</shipmentDate>\r\n      <serviceCode>INPS</serviceCode>\r\n      <totalPieces>1</totalPieces>\r\n      <totalWeight>5</totalWeight>\r\n      <weightUOM>K</weightUOM>\r\n      <dimensions>\r\n        <uom>C</uom>\r\n        <length>20</length>\r\n        <width>20</width>\r\n        <height>20</height>\r\n      </dimensions>\r\n      <contentTypeCode>NDX</contentTypeCode>\r\n      <descriptionOfGoods>SKIN CARE</descriptionOfGoods>\r\n      <declaredCurrencyValue>80.33</declaredCurrencyValue>\r\n      <declaredCurrencyCode>GBP</declaredCurrencyCode>\r\n      <incotermsCode>DDU</incotermsCode>\r\n      <itemDetail>\r\n        <hsCode>999999999</hsCode>\r\n        <description>FOREO LUNA MINI</description>\r\n        <quantity>1</quantity>\r\n        <currencyValue>52.33</currencyValue>\r\n        <countryOfOrigin>GB</countryOfOrigin>\r\n        <sku>121112</sku>\r\n        <netWeight>1</netWeight>\r\n      </itemDetail>\r\n\t  <itemDetail>\r\n        <hsCode>999999999</hsCode>\r\n        <description>FOREO LUNA MINI</description>\r\n        <quantity>1</quantity>\r\n        <currencyValue>52.33</currencyValue>\r\n        <countryOfOrigin>GB</countryOfOrigin>\r\n        <sku>6734567812</sku>\r\n        <netWeight>1</netWeight>\r\n      </itemDetail>\r\n    </shipmentDetail>\r\n  </shipment>\r\n</createShipmentRequest>"
                        variable: request.body
                        content: application/xml
                      rmg_headers:
                        schema:
                          type: object
                          properties:
                            X-RMG-Password:
                              type: string
                            X-RMG-Nonce:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                            X-RMG-User-Name:
                              type: string
                        variable: request.headers
                    outputs:
                      response:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createShipmentRequest:
                              type: object
                              properties:
                                shipment:
                                  type: object
                                  properties:
                                    shipper:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        addressLine2:
                                          type: string
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                        reference:
                                          type: string
                                      xml:
                                        namespace: ''
                                    destination:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                      xml:
                                        namespace: ''
                                    shipmentDetail:
                                      type: object
                                      properties:
                                        shipmentDate:
                                          type: string
                                        serviceCode:
                                          type: string
                                        totalPieces:
                                          type: string
                                        totalWeight:
                                          type: string
                                        weightUOM:
                                          type: string
                                        dimensions:
                                          type: object
                                          properties:
                                            uom:
                                              type: string
                                            length:
                                              type: string
                                            width:
                                              type: string
                                            height:
                                              type: string
                                          xml:
                                            namespace: ''
                                        contentTypeCode:
                                          type: string
                                        descriptionOfGoods:
                                          type: string
                                        declaredCurrencyValue:
                                          type: string
                                        declaredCurrencyCode:
                                          type: string
                                        incotermsCode:
                                          type: string
                                        itemDetail:
                                          type: array
                                          items:
                                            properties:
                                              hsCode:
                                                type: string
                                              description:
                                                type: string
                                              quantity:
                                                type: string
                                              currencyValue:
                                                type: string
                                              countryOfOrigin:
                                                type: string
                                              sku:
                                                type: string
                                              netWeight:
                                                type: string
                                            type: object
                                            xml:
                                              namespace: ''
                                      xml:
                                        namespace: ''
                                  xml:
                                    namespace: ''
                              xml:
                                namespace: ''
                          xml:
                            namespace: ''
                          example: "<createShipmentRequest>\r\n  <shipment>\r\n    <shipper>\r\n      <companyName>INTERSOFT</companyName>\r\n      <addressLine1>THE MILL STUDIO</addressLine1>\r\n      <addressLine2>HORTON ROAD</addressLine2>\r\n      <addressLine3></addressLine3>\r\n      <city>STANWELL MOOR</city>\r\n      <county>MIDX</county>\r\n      <countryCode>GB</countryCode>\r\n      <postCode>TW19 6BJ</postCode>\r\n      <contactName>ARNOLD</contactName>\r\n      <phoneNumber>017536892921234567891</phoneNumber>\r\n      <vatNumber>GB123456912345678</vatNumber>\r\n      <emailAddress>SUPPORT@INTERSOFT.CO.UK</emailAddress>\r\n      <reference>INPSAUSSSYD</reference>\r\n      <departmentCode></departmentCode>\r\n    </shipper>\r\n    <destination>\r\n      <companyName>12345678901234567890123456789012345</companyName>\r\n      <addressLine1>11 Town Terrace</addressLine1>\r\n      <addressLine2></addressLine2>\r\n      <addressLine3></addressLine3>\r\n      <city>Glenmore Park</city>\r\n      <county>NSW</county>\r\n      <countryCode>AU</countryCode>\r\n      <postCode>2745</postCode>\r\n      <contactName>ARNOLD</contactName>\r\n      <phoneNumber>1545554455</phoneNumber>\r\n      <vatNumber>GB123456912345678</vatNumber>\r\n      <emailAddress>arnold.christian@intersoft.co.uk</emailAddress>\r\n    </destination>\r\n    <shipmentDetail>\r\n      <shipmentDate>2011-07-14</shipmentDate>\r\n      <serviceCode>INPS</serviceCode>\r\n      <totalPieces>1</totalPieces>\r\n      <totalWeight>5</totalWeight>\r\n      <weightUOM>K</weightUOM>\r\n      <dimensions>\r\n        <uom>C</uom>\r\n        <length>20</length>\r\n        <width>20</width>\r\n        <height>20</height>\r\n      </dimensions>\r\n      <contentTypeCode>NDX</contentTypeCode>\r\n      <descriptionOfGoods>SKIN CARE</descriptionOfGoods>\r\n      <declaredCurrencyValue>80.33</declaredCurrencyValue>\r\n      <declaredCurrencyCode>GBP</declaredCurrencyCode>\r\n      <incotermsCode>DDU</incotermsCode>\r\n      <itemDetail>\r\n        <hsCode>999999999</hsCode>\r\n        <description>FOREO LUNA MINI</description>\r\n        <quantity>1</quantity>\r\n        <currencyValue>52.33</currencyValue>\r\n        <countryOfOrigin>GB</countryOfOrigin>\r\n        <sku>12112</sku>\r\n        <netWeight>1</netWeight>\r\n      </itemDetail>\r\n\t  <itemDetail>\r\n        <hsCode>999999999</hsCode>\r\n        <description>FOREO LUNA MINI</description>\r\n        <quantity>1</quantity>\r\n        <currencyValue>52.33</currencyValue>\r\n        <countryOfOrigin>GB</countryOfOrigin>\r\n        <sku>1211</sku>\r\n        <netWeight>1</netWeight>\r\n      </itemDetail>\r\n    </shipmentDetail>\r\n  </shipment>\r\n</createShipmentRequest>"
                        variable: message.body
                        content: application/xml
                      out1:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    actions:
                      - set: response.createShipmentRequest.shipment.shipper.addressLine1
                        from: input.createShipmentRequest.shipment.shipper.addressLine1
                      - set: response.createShipmentRequest.shipment.shipper.addressLine2
                        from: input.createShipmentRequest.shipment.shipper.addressLine2
                      - set: response.createShipmentRequest.shipment.shipper.city
                        from: input.createShipmentRequest.shipment.shipper.city
                      - set: response.createShipmentRequest.shipment.shipper.county
                        from: input.createShipmentRequest.shipment.shipper.county
                      - set: response.createShipmentRequest.shipment.shipper.countryCode
                        from: input.createShipmentRequest.shipment.shipper.countryCode
                      - set: response.createShipmentRequest.shipment.shipper.postCode
                        from: input.createShipmentRequest.shipment.shipper.postCode
                      - set: response.createShipmentRequest.shipment.shipper.contactName
                        from: input.createShipmentRequest.shipment.shipper.contactName
                      - set: response.createShipmentRequest.shipment.shipper.phoneNumber
                        from: input.createShipmentRequest.shipment.shipper.phoneNumber
                      - set: response.createShipmentRequest.shipment.shipper.vatNumber
                        from: input.createShipmentRequest.shipment.shipper.vatNumber
                      - set: response.createShipmentRequest.shipment.shipper.emailAddress
                        from: input.createShipmentRequest.shipment.shipper.emailAddress
                      - set: response.createShipmentRequest.shipment.shipper.reference
                        from: input.createShipmentRequest.shipment.shipper.reference
                      - set: response.createShipmentRequest.shipment.destination.companyName
                        from: input.createShipmentRequest.shipment.destination.companyName
                      - set: response.createShipmentRequest.shipment.destination.addressLine1
                        from: input.createShipmentRequest.shipment.destination.addressLine1
                      - set: response.createShipmentRequest.shipment.destination.city
                        from: input.createShipmentRequest.shipment.destination.city
                      - set: response.createShipmentRequest.shipment.destination.county
                        from: input.createShipmentRequest.shipment.destination.county
                      - set: response.createShipmentRequest.shipment.destination.countryCode
                        from: input.createShipmentRequest.shipment.destination.countryCode
                      - set: response.createShipmentRequest.shipment.destination.postCode
                        from: input.createShipmentRequest.shipment.destination.postCode
                      - set: response.createShipmentRequest.shipment.destination.contactName
                        from: input.createShipmentRequest.shipment.destination.contactName
                      - set: response.createShipmentRequest.shipment.destination.phoneNumber
                        from: input.createShipmentRequest.shipment.destination.phoneNumber
                      - set: response.createShipmentRequest.shipment.destination.vatNumber
                        from: input.createShipmentRequest.shipment.destination.vatNumber
                      - set: response.createShipmentRequest.shipment.destination.emailAddress
                        from: input.createShipmentRequest.shipment.destination.emailAddress
                      - set: response.createShipmentRequest.shipment.shipmentDetail.shipmentDate
                        from: input.createShipmentRequest.shipment.shipmentDetail.shipmentDate
                      - set: response.createShipmentRequest.shipment.shipmentDetail.serviceCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.serviceCode
                      - set: response.createShipmentRequest.shipment.shipmentDetail.totalPieces
                        from: input.createShipmentRequest.shipment.shipmentDetail.totalPieces
                      - set: response.createShipmentRequest.shipment.shipmentDetail.totalWeight
                        from: input.createShipmentRequest.shipment.shipmentDetail.totalWeight
                      - set: response.createShipmentRequest.shipment.shipmentDetail.weightUOM
                        from: input.createShipmentRequest.shipment.shipmentDetail.weightUOM
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.uom
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.uom
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.length
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.length
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.width
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.width
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.height
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.height
                      - set: response.createShipmentRequest.shipment.shipmentDetail.contentTypeCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.contentTypeCode
                      - set: response.createShipmentRequest.shipment.shipmentDetail.descriptionOfGoods
                        from: input.createShipmentRequest.shipment.shipmentDetail.descriptionOfGoods
                      - set: response.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyValue
                        from: input.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyValue
                      - set: response.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyCode
                      - set: response.createShipmentRequest.shipment.shipmentDetail.incotermsCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.incotermsCode
                      - set: response.createShipmentRequest.shipment.shipper.companyName
                        from: input.createShipmentRequest.shipment.shipper.companyName
                      - set: out1.X-RMG-Transaction-Id
                        from: rmg_headers.X-RMG-Nonce
                      - set: out1.X-RMG-Date-Time
                        from: rmg_headers.X-RMG-Date-Time
                      - create: response.createShipmentRequest.shipment.shipmentDetail.itemDetail
                        foreach: input.createShipmentRequest.shipment.shipmentDetail.itemDetail
                        from: input.createShipmentRequest.shipment.shipmentDetail.itemDetail
                        actions:
                          - set: hsCode
                            from: hsCode
                          - set: description
                            from: description
                          - set: quantity
                            from: quantity
                          - set: currencyValue
                            from: currencyValue
                          - set: countryOfOrigin
                            from: countryOfOrigin
                          - set: sku
                            from: sku
                          - set: netWeight
                            from: netWeight
                          - set: $item
                            from: $item
                    version: 1.0.0
                    options:
                      includeEmptyXMLElements: false
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: "apim.setvariable('message.headers.X-RMG-Nonce',undefined);\n\nvar Count = apim.getvariable('message.headers.X-RMG-Transaction-Id');  \n\nif(Count != undefined ){\n \n    var Base64 = {\n\n\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\t\n\t\n\tdecode: function(input) {\n        var output = \"\";\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n        while (i < input.length) {\n\n            enc1 = this._keyStr.indexOf(input.charAt(i++));\n            enc2 = this._keyStr.indexOf(input.charAt(i++));\n            enc3 = this._keyStr.indexOf(input.charAt(i++));\n            enc4 = this._keyStr.indexOf(input.charAt(i++)); \n\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n\n            output = output + String.fromCharCode(chr1);\n\n            if (enc3 != 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 != 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n\n        }\n\n        output = Base64._utf8_decode(output);\n\n        return output;\n\n    },\n\t\n\t\n\t _utf8_decode: function(utftext) {\n        var string = \"\";\n        var i = 0;\n        var c = 0;\n        var c1 = 0;\n        var c2 = 0;\n        var c3 = 0;\n\n        while (i < utftext.length) {\n\n            c = utftext.charCodeAt(i); \n\n            if (c < 128) {\n                string += String.fromCharCode(c);\n                i++;\n            }\n            else if ((c > 191) && (c < 224)) {\n                c2 = utftext.charCodeAt(i + 1);\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                i += 2;\n            }\n            else {\n                c2 = utftext.charCodeAt(i + 1);\n                c3 = utftext.charCodeAt(i + 2);\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                i += 3;\n            }\n\n        }\n\n        return string;\n    }\n\n}\n\n var input_Out = Base64.decode(Count);\n \nfunction bytes (str) {\n  var bytes=0, len=str.length, codePoint, next, i;\n\n  for (i=0; i < len; i++) {\n    codePoint = str.charCodeAt(i); \n\n    // Lone surrogates cannot be passed to encodeURI\n    if (codePoint >= 0xD800 && codePoint < 0xE000) {\n      if (codePoint < 0xDC00 && i + 1 < len) {\n        next = str.charCodeAt(i + 1);\n\n        if (next >= 0xDC00 && next < 0xE000) {\n          bytes += 4;\n          i++;\n          continue;\n        }\n      }\n    } \n\n    bytes += (codePoint < 0x80 ? 1 : (codePoint < 0x800 ? 2 : 3));\n  }\n\n  return bytes;\n}\n\nvar in_1 = bytes(input_Out);\n\n if(in_1 < 17 ) \n {\napim.setvariable('message.headers.X-RMG-Transaction-Id',input_Out);\n \n }\n else\n {\n  apim.error('E0014', 400, 'Bad Request', 'Invalid Transaction-Id provided in API request');\n }\n \n }\n \n\n"
                - map:
                    title: createShipmentMap
                    inputs:
                      input:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createShipmentRequest:
                              type: object
                              properties:
                                shipment:
                                  type: object
                                  properties:
                                    shipper:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        addressLine2:
                                          type: string
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                        reference:
                                          type: string
                                      xml:
                                        namespace: ''
                                    destination:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                      xml:
                                        namespace: ''
                                    shipmentDetail:
                                      type: object
                                      properties:
                                        shipmentDate:
                                          type: string
                                        serviceCode:
                                          type: string
                                        totalPieces:
                                          type: string
                                        totalWeight:
                                          type: string
                                        weightUOM:
                                          type: string
                                        dimensions:
                                          type: object
                                          properties:
                                            uom:
                                              type: string
                                            length:
                                              type: string
                                            width:
                                              type: string
                                            height:
                                              type: string
                                          xml:
                                            namespace: ''
                                        contentTypeCode:
                                          type: string
                                        descriptionOfGoods:
                                          type: string
                                        declaredCurrencyValue:
                                          type: string
                                        declaredCurrencyCode:
                                          type: string
                                        incotermsCode:
                                          type: string
                                        itemDetail:
                                          type: array
                                          items:
                                            properties:
                                              hsCode:
                                                type: string
                                              description:
                                                type: string
                                              quantity:
                                                type: string
                                              currencyValue:
                                                type: string
                                              countryOfOrigin:
                                                type: string
                                              sku:
                                                type: string
                                              netWeight:
                                                type: string
                                            type: object
                                            xml:
                                              namespace: ''
                                      xml:
                                        namespace: ''
                                  xml:
                                    namespace: ''
                              xml:
                                namespace: ''
                          xml:
                            namespace: ''
                          example: "<createShipmentRequest>\r\n  <shipment>\r\n    <shipper>\r\n      <companyName>INTERSOFT</companyName>\r\n      <addressLine1>THE MILL STUDIO</addressLine1>\r\n      <addressLine2>HORTON ROAD</addressLine2>\r\n      <addressLine3></addressLine3>\r\n      <city>STANWELL MOOR</city>\r\n      <county>MIDX</county>\r\n      <countryCode>GB</countryCode>\r\n      <postCode>TW19 6BJ</postCode>\r\n      <contactName>ARNOLD</contactName>\r\n      <phoneNumber>017536892921234567891</phoneNumber>\r\n      <vatNumber>GB123456912345678</vatNumber>\r\n      <emailAddress>SUPPORT@INTERSOFT.CO.UK</emailAddress>\r\n      <reference>INPSAUSSSYD</reference>\r\n      <departmentCode></departmentCode>\r\n    </shipper>\r\n    <destination>\r\n      <companyName>12345678901234567890123456789012345</companyName>\r\n      <addressLine1>11 Town Terrace</addressLine1>\r\n      <addressLine2></addressLine2>\r\n      <addressLine3></addressLine3>\r\n      <city>Glenmore Park</city>\r\n      <county>NSW</county>\r\n      <countryCode>AU</countryCode>\r\n      <postCode>2745</postCode>\r\n      <contactName>ARNOLD</contactName>\r\n      <phoneNumber>1545554455</phoneNumber>\r\n      <vatNumber>GB123456912345678</vatNumber>\r\n      <emailAddress>arnold.christian@intersoft.co.uk</emailAddress>\r\n    </destination>\r\n    <shipmentDetail>\r\n      <shipmentDate>2011-07-14</shipmentDate>\r\n      <serviceCode>INPS</serviceCode>\r\n      <totalPieces>1</totalPieces>\r\n      <totalWeight>5</totalWeight>\r\n      <weightUOM>K</weightUOM>\r\n      <dimensions>\r\n        <uom>C</uom>\r\n        <length>20</length>\r\n        <width>20</width>\r\n        <height>20</height>\r\n      </dimensions>\r\n      <contentTypeCode>NDX</contentTypeCode>\r\n      <descriptionOfGoods>SKIN CARE</descriptionOfGoods>\r\n      <declaredCurrencyValue>80.33</declaredCurrencyValue>\r\n      <declaredCurrencyCode>GBP</declaredCurrencyCode>\r\n      <incotermsCode>DDU</incotermsCode>\r\n      <itemDetail>\r\n        <hsCode>999999999</hsCode>\r\n        <description>FOREO LUNA MINI</description>\r\n        <quantity>1</quantity>\r\n        <currencyValue>52.33</currencyValue>\r\n        <countryOfOrigin>GB</countryOfOrigin>\r\n        <sku>12121</sku>\r\n        <netWeight>1</netWeight>\r\n      </itemDetail>\r\n\t  <itemDetail>\r\n        <hsCode>999999999</hsCode>\r\n        <description>FOREO LUNA MINI</description>\r\n        <quantity>1</quantity>\r\n        <currencyValue>52.33</currencyValue>\r\n        <countryOfOrigin>GB</countryOfOrigin>\r\n        <sku>2121</sku>\r\n        <netWeight>1</netWeight>\r\n      </itemDetail>\r\n    </shipmentDetail>\r\n  </shipment>\r\n</createShipmentRequest>"
                        variable: message.body
                        content: application/xml
                      input_1:
                        schema:
                          type: object
                          properties:
                            X-RMG-Transaction-Id:
                              type: string
                            X-RMG-Date-Time:
                              type: string
                        variable: message.headers
                    outputs:
                      response:
                        schema:
                          description: ''
                          type: object
                          properties:
                            createShipmentRequest:
                              type: object
                              properties:
                                integrationHeader:
                                  type: object
                                  properties:
                                    dateTime:
                                      type: string
                                    applicationId:
                                      type: string
                                    transactionId:
                                      type: string
                                shipment:
                                  type: object
                                  properties:
                                    shipper:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        addressLine2:
                                          type: string
                                        addressLine3:
                                          type: object
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                        reference:
                                          type: string
                                        departmentCode:
                                          type: string
                                    destination:
                                      type: object
                                      properties:
                                        companyName:
                                          type: string
                                        addressLine1:
                                          type: string
                                        addressLine2:
                                          type: object
                                        addressLine3:
                                          type: object
                                        city:
                                          type: string
                                        county:
                                          type: string
                                        countryCode:
                                          type: string
                                        postCode:
                                          type: string
                                        contactName:
                                          type: string
                                        phoneNumber:
                                          type: string
                                        vatNumber:
                                          type: string
                                        emailAddress:
                                          type: string
                                    shipmentDetail:
                                      type: object
                                      properties:
                                        shipmentDate:
                                          type: string
                                        serviceCode:
                                          type: string
                                        totalPieces:
                                          type: string
                                        totalWeight:
                                          type: string
                                        weightUOM:
                                          type: string
                                        dimensions:
                                          type: object
                                          properties:
                                            uom:
                                              type: string
                                            length:
                                              type: string
                                            width:
                                              type: string
                                            height:
                                              type: string
                                        contentTypeCode:
                                          type: string
                                        descriptionOfGoods:
                                          type: string
                                        declaredCurrencyValue:
                                          type: string
                                        declaredCurrencyCode:
                                          type: string
                                        incotermsCode:
                                          type: string
                                        itemDetail:
                                          type: array
                                          items:
                                            properties:
                                              hsCode:
                                                type: string
                                              description:
                                                type: string
                                              quantity:
                                                type: string
                                              currencyValue:
                                                type: string
                                              countryOfOrigin:
                                                type: string
                                              sku:
                                                type: string
                                              netWeight:
                                                type: string
                                            type: object
                                schemaLocation:
                                  type: string
                                  xml:
                                    attribute: true
                                    prefix: xsi
                              xml:
                                namespace: 'http://www.royalmailgroup.com/api/international/shipment/V1'
                                prefix: ns
                          xml:
                            namespace: ''
                          example: "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<ns:createShipmentRequest xmlns:dt=\"http://www.royalmailgroup.com/cm/rmDatatypes/V1\" xmlns:int=\"http://www.royalmailgroup.com/integration/core/V3\" xmlns:ns=\"http://www.royalmailgroup.com/api/international/shipment/V1\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.royalmailgroup.com/api/international/shipment/V1/InternationalShippingAPI_V1_BIG.xsd \">\r\n   <ns:integrationHeader>\r\n    <ns:dateTime>2001-12-31T12:00:00</ns:dateTime>\r\n    <ns:applicationId>ns:applicationId</ns:applicationId>\r\n    <ns:transactionId>ns:transactionId</ns:transactionId>\r\n   </ns:integrationHeader>\r\n  <ns:shipment>\r\n    <ns:shipper>\r\n      <ns:companyName>INTERSOFT</ns:companyName>\r\n      <ns:addressLine1>THE MILL STUDIO</ns:addressLine1>\r\n      <ns:addressLine2>HORTON ROAD</ns:addressLine2>\r\n      <ns:addressLine3></ns:addressLine3>\r\n      <ns:city>STANWELL MOOR</ns:city>\r\n      <ns:county>MIDX</ns:county>\r\n      <ns:countryCode>GB</ns:countryCode>\r\n      <ns:postCode>TW19 6BJ</ns:postCode>\r\n      <ns:contactName>ARNOLD</ns:contactName>\r\n      <ns:phoneNumber>017536892921234567891</ns:phoneNumber>\r\n      <ns:vatNumber>GB123456912345678</ns:vatNumber>\r\n      <ns:emailAddress>SUPPORT@INTERSOFT.CO.UK</ns:emailAddress>\r\n      <ns:reference>INPSAUSSSYD</ns:reference>\r\n      <ns:departmentCode>?</ns:departmentCode>\r\n    </ns:shipper>\r\n    <ns:destination>\r\n      <ns:companyName>SSYD INPS COMPANY</ns:companyName>\r\n      <ns:addressLine1>11 Town Terrace</ns:addressLine1>\r\n      <ns:addressLine2></ns:addressLine2>\r\n      <ns:addressLine3></ns:addressLine3>\r\n      <ns:city>Glenmore Park</ns:city>\r\n      <ns:county>NSW</ns:county>\r\n      <ns:countryCode>AU</ns:countryCode>\r\n      <ns:postCode>2745</ns:postCode>\r\n      <ns:contactName>ARNOLD</ns:contactName>\r\n      <ns:phoneNumber>1545554455</ns:phoneNumber>\r\n      <ns:vatNumber>GB123456912345678</ns:vatNumber>\r\n      <ns:emailAddress>arnold.christian@intersoft.co.uk</ns:emailAddress>\r\n    </ns:destination>\r\n    <ns:shipmentDetail>\r\n      <ns:shipmentDate>2011-07-14</ns:shipmentDate>\r\n      <ns:serviceCode>INPS</ns:serviceCode>\r\n      <ns:totalPieces>1</ns:totalPieces>\r\n      <ns:totalWeight>5</ns:totalWeight>\r\n      <ns:weightUOM>K</ns:weightUOM>\r\n      <ns:dimensions>\r\n        <ns:uom>C</ns:uom>\r\n        <ns:length>20</ns:length>\r\n        <ns:width>20</ns:width>\r\n        <ns:height>20</ns:height>\r\n      </ns:dimensions>\r\n      <ns:contentTypeCode>NDX</ns:contentTypeCode>\r\n      <ns:descriptionOfGoods>SKIN CARE</ns:descriptionOfGoods>\r\n      <ns:declaredCurrencyValue>80.33</ns:declaredCurrencyValue>\r\n      <ns:declaredCurrencyCode>GBP</ns:declaredCurrencyCode>\r\n      <ns:incotermsCode>DDU</ns:incotermsCode>\r\n      <ns:itemDetail>\r\n        <ns:hsCode>999999999</ns:hsCode>\r\n        <ns:description>FOREO LUNA MINI</ns:description>\r\n        <ns:quantity>1</ns:quantity>\r\n        <ns:currencyValue>52.33</ns:currencyValue>\r\n        <ns:countryOfOrigin>GB</ns:countryOfOrigin>\r\n        <ns:sku>11212</ns:sku>\r\n        <ns:netWeight>1</ns:netWeight>\r\n      </ns:itemDetail>\r\n\t  <ns:itemDetail>\r\n        <ns:hsCode>999999999</ns:hsCode>\r\n        <ns:description>FOREO LUNA MINI</ns:description>\r\n        <ns:quantity>1</ns:quantity>\r\n        <ns:currencyValue>52.33</ns:currencyValue>\r\n        <ns:countryOfOrigin>GB</ns:countryOfOrigin>\r\n        <ns:sku>2121</ns:sku>\r\n        <ns:netWeight>1</ns:netWeight>\r\n      </ns:itemDetail>\r\n\t  \r\n    </ns:shipmentDetail>\r\n  </ns:shipment>\r\n</ns:createShipmentRequest>"
                        variable: message.body
                        content: application/xml
                    actions:
                      - set: response.createShipmentRequest.shipment.shipper.addressLine1
                        from: input.createShipmentRequest.shipment.shipper.addressLine1
                      - set: response.createShipmentRequest.shipment.shipper.addressLine2
                        from: input.createShipmentRequest.shipment.shipper.addressLine2
                      - set: response.createShipmentRequest.shipment.shipper.city
                        from: input.createShipmentRequest.shipment.shipper.city
                      - set: response.createShipmentRequest.shipment.shipper.county
                        from: input.createShipmentRequest.shipment.shipper.county
                      - set: response.createShipmentRequest.shipment.shipper.countryCode
                        from: input.createShipmentRequest.shipment.shipper.countryCode
                      - set: response.createShipmentRequest.shipment.shipper.postCode
                        from: input.createShipmentRequest.shipment.shipper.postCode
                      - set: response.createShipmentRequest.shipment.shipper.contactName
                        from: input.createShipmentRequest.shipment.shipper.contactName
                      - set: response.createShipmentRequest.shipment.shipper.phoneNumber
                        from: input.createShipmentRequest.shipment.shipper.phoneNumber
                      - set: response.createShipmentRequest.shipment.shipper.vatNumber
                        from: input.createShipmentRequest.shipment.shipper.vatNumber
                      - set: response.createShipmentRequest.shipment.shipper.emailAddress
                        from: input.createShipmentRequest.shipment.shipper.emailAddress
                      - set: response.createShipmentRequest.shipment.shipper.reference
                        from: input.createShipmentRequest.shipment.shipper.reference
                      - set: response.createShipmentRequest.shipment.destination.companyName
                        from: input.createShipmentRequest.shipment.destination.companyName
                      - set: response.createShipmentRequest.shipment.destination.addressLine1
                        from: input.createShipmentRequest.shipment.destination.addressLine1
                      - set: response.createShipmentRequest.shipment.destination.city
                        from: input.createShipmentRequest.shipment.destination.city
                      - set: response.createShipmentRequest.shipment.destination.county
                        from: input.createShipmentRequest.shipment.destination.county
                      - set: response.createShipmentRequest.shipment.destination.countryCode
                        from: input.createShipmentRequest.shipment.destination.countryCode
                      - set: response.createShipmentRequest.shipment.destination.postCode
                        from: input.createShipmentRequest.shipment.destination.postCode
                      - set: response.createShipmentRequest.shipment.destination.contactName
                        from: input.createShipmentRequest.shipment.destination.contactName
                      - set: response.createShipmentRequest.shipment.destination.phoneNumber
                        from: input.createShipmentRequest.shipment.destination.phoneNumber
                      - set: response.createShipmentRequest.shipment.destination.vatNumber
                        from: input.createShipmentRequest.shipment.destination.vatNumber
                      - set: response.createShipmentRequest.shipment.destination.emailAddress
                        from: input.createShipmentRequest.shipment.destination.emailAddress
                      - set: response.createShipmentRequest.shipment.shipmentDetail.shipmentDate
                        from: input.createShipmentRequest.shipment.shipmentDetail.shipmentDate
                      - set: response.createShipmentRequest.shipment.shipmentDetail.serviceCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.serviceCode
                      - set: response.createShipmentRequest.shipment.shipmentDetail.totalPieces
                        from: input.createShipmentRequest.shipment.shipmentDetail.totalPieces
                      - set: response.createShipmentRequest.shipment.shipmentDetail.totalWeight
                        from: input.createShipmentRequest.shipment.shipmentDetail.totalWeight
                      - set: response.createShipmentRequest.shipment.shipmentDetail.weightUOM
                        from: input.createShipmentRequest.shipment.shipmentDetail.weightUOM
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.uom
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.uom
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.length
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.length
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.width
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.width
                      - set: response.createShipmentRequest.shipment.shipmentDetail.dimensions.height
                        from: input.createShipmentRequest.shipment.shipmentDetail.dimensions.height
                      - set: response.createShipmentRequest.shipment.shipmentDetail.contentTypeCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.contentTypeCode
                      - set: response.createShipmentRequest.shipment.shipmentDetail.descriptionOfGoods
                        from: input.createShipmentRequest.shipment.shipmentDetail.descriptionOfGoods
                      - set: response.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyValue
                        from: input.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyValue
                      - set: response.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.declaredCurrencyCode
                      - set: response.createShipmentRequest.shipment.shipmentDetail.incotermsCode
                        from: input.createShipmentRequest.shipment.shipmentDetail.incotermsCode
                      - create: response.createShipmentRequest.shipment.shipmentDetail.itemDetail
                        foreach: input.createShipmentRequest.shipment.shipmentDetail.itemDetail
                        from: input.createShipmentRequest.shipment.shipmentDetail.itemDetail
                        actions:
                          - set: hsCode
                            from: hsCode
                          - set: description
                            from: description
                          - set: quantity
                            from: quantity
                          - set: currencyValue
                            from: currencyValue
                          - set: netWeight
                            from: netWeight
                          - set: countryOfOrigin
                            from: countryOfOrigin
                          - set: sku
                            from: sku
                          - set: $item
                            from: $item
                      - set: response.createShipmentRequest.shipment.shipper.companyName
                        from: input.createShipmentRequest.shipment.shipper.companyName
                      - set: response.createShipmentRequest.integrationHeader.applicationId
                        default: $(api.properties.ApplicationId)
                      - set: response.createShipmentRequest.integrationHeader.dateTime
                        from: input_1.X-RMG-Date-Time
                      - set: response.createShipmentRequest.integrationHeader.transactionId
                        from: input_1.X-RMG-Transaction-Id
                    version: 1.0.0
                    options:
                      includeEmptyXMLElements: false
                - invoke:
                    title: createShipmentInvoke
                    timeout: 60
                    verb: POST
                    cache-response: protocol
                    cache-ttl: 900
                    version: 1.0.0
                    tls-profile: onboarding-pre-prod-test-ca2
                    target-url: 'https://sit-api.royalmail.com/international/shipment/v1'
                    output: Response
                - gatewayscript:
                    title: gatewayscript
                    version: 1.0.0
                    source: " var Response_1 = apim.getvariable('Response.body');\n \n apim.setvariable('message.body',Response_1);"
      - activity-log:
          content: $(activity.log.level)
          error-content: $(error.log.level)
    catch: []
tags: []
securityDefinitions:
  Client ID:
    description: ''
    in: header
    name: X-IBM-Client-Id
    type: apiKey
  Client Secret:
    type: apiKey
    name: X-IBM-Client-Secret
    in: header
    description: ''
paths:
  '/{trackingNumber}':
    delete:
      description: Cancels a shipment which has yet not been confirmed.
      tags: []
      parameters:
        - description: Tracking Number of Shipment.
          name: trackingNumber
          type: string
          required: true
          in: path
        - name: X-RMG-Nonce
          type: string
          required: true
          in: header
          description: Base64 encoded Nonce
        - name: X-RMG-Date-Time
          type: string
          required: true
          in: header
          description: Timestamp of Label generation
        - name: X-RMG-User-Name
          type: string
          required: true
          in: header
          description: This is theâ€ Web Service User Idâ€ field value in the Api Security tab on the customer maintenance screen
        - name: X-RMG-Password
          type: string
          required: true
          in: header
          format: password
          description: This is unique hashed password digest string
      responses:
        '200':
          schema: {}
          description: ''
          examples:
            application/xml: >-
              <?xml version="1.0" encoding="UTF-8"?>

              <ns:cancelShipmentResponse
              xmlns:dt="http://www.royalmailgroup.com/cm/rmDatatypes/V1"
              xmlns:int="http://www.royalmailgroup.com/integration/core/V3"
              xmlns:ns="http://www.royalmailgroup.com/api/international/shipment/V1"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.royalmailgroup.com/api/international/shipment/V1
              InternationalShippingAPI_V1_BIG.xsd ">

                <ns:integrationHeader>

                  <ns:dateTime>2001-12-31T12:00:00</ns:dateTime>

                  <ns:applicationId>ns:applicationId</ns:applicationId>

                  <ns:transactionId>ns:transactionId</ns:transactionId>

                </ns:integrationHeader>

                <ns:cancelled>

                  <ns:trackingNumber>ns:trackingNumber</ns:trackingNumber>

                </ns:cancelled>

                <ns:integrationFooter>

                  <errors/>

                  <warnings/>

                </ns:integrationFooter>

              </ns:cancelShipmentResponse>
      summary: Cancels a shipment which has yet not been confirmed.
  /:
    post:
      description: Creates an international tracked direct shipment in the system and returns a final mile carrier label.  Shipment stays in unprocessed state until confirmed by CreateBag operation.
      tags: []
      parameters:
        - schema:
            example: >-
              <?xml version="1.0" encoding="UTF-8"?>

              <ns:createShipmentRequest
              xmlns:dt="http://www.royalmailgroup.com/cm/rmDatatypes/V1"
              xmlns:int="http://www.royalmailgroup.com/integration/core/V3"
              xmlns:ns="http://www.royalmailgroup.com/api/international/shipment/V1"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.royalmailgroup.com/api/international/shipment/V1
              InternationalShippingAPI_V1_BIG.xsd ">

                <ns:integrationHeader>

                  <ns:dateTime>2001-12-31T12:00:00</ns:dateTime>

                  <ns:applicationId>0703386001</ns:applicationId>

                  <ns:transactionId>BCMYH-ZOOFY-XPRKB-FKCCT-TTURS-ZN</ns:transactionId>

                </ns:integrationHeader>

                <ns:shipment>

                  <ns:shipper>

                    <ns:companyName>INTERSOFT</ns:companyName>

                    <ns:addressLine1>THE MILL STUDIO</ns:addressLine1>

                    <ns:addressLine2>HORTON ROAD</ns:addressLine2>

                    <ns:addressLine3></ns:addressLine3>

                    <ns:city>STANWELL MOOR</ns:city>

                    <ns:county>MIDX</ns:county>

                    <ns:countryCode>GB</ns:countryCode>

                    <ns:postCode>TW19 6BJ</ns:postCode>

                    <ns:contactName>ARNOLD</ns:contactName>

                    <ns:phoneNumber>017536892921234567891</ns:phoneNumber>

                    <ns:vatNumber>GB123456912345678</ns:vatNumber>

                    <ns:emailAddress>SUPPORT@INTERSOFT.CO.UK</ns:emailAddress>

                    <ns:reference>INPSAUSSSYD</ns:reference>

                    <ns:departmentCode></ns:departmentCode>

                  </ns:shipper>

                  <ns:destination>

                    <ns:companyName>SSYD INPS COMPANY</ns:companyName>

                    <ns:addressLine1>11 Town Terrace</ns:addressLine1>

                    <ns:addressLine2></ns:addressLine2>

                    <ns:addressLine3></ns:addressLine3>

                    <ns:city>Glenmore Park</ns:city>

                    <ns:county>NSW</ns:county>

                    <ns:countryCode>AU</ns:countryCode>

                    <ns:postCode>2745</ns:postCode>

                    <ns:contactName>ARNOLD</ns:contactName>

                    <ns:phoneNumber>1545554455</ns:phoneNumber>

                    <ns:vatNumber>GB123456912345678</ns:vatNumber>

                    <ns:emailAddress>arnold.christian@intersoft.co.uk</ns:emailAddress>

                  </ns:destination>

                  <ns:shipmentDetail>

                    <ns:shipmentDate>2011-07-14</ns:shipmentDate>

                    <ns:serviceCode>INPS</ns:serviceCode>

                    <ns:totalPieces>1</ns:totalPieces>

                    <ns:totalWeight>5</ns:totalWeight>

                    <ns:weightUOM>K</ns:weightUOM>

                    <ns:dimensions>

                      <ns:uom>C</ns:uom>

                      <ns:length>20</ns:length>

                      <ns:width>20</ns:width>

                      <ns:height>20</ns:height>

                    </ns:dimensions>

                    <ns:contentTypeCode>NDX</ns:contentTypeCode>

                    <ns:descriptionOfGoods>SKIN CARE</ns:descriptionOfGoods>

                    <ns:declaredCurrencyValue>80.33</ns:declaredCurrencyValue>

                    <ns:declaredCurrencyCode>GBP</ns:declaredCurrencyCode>

                    <ns:incotermsCode>DDU</ns:incotermsCode>

                    <ns:itemDetail>

                      <ns:hsCode>999999999</ns:hsCode>

                      <ns:description>FOREO LUNA MINI</ns:description>

                      <ns:quantity>1</ns:quantity>

                      <ns:currencyValue>52.33</ns:currencyValue>

                      <ns:countryOfOrigin>GB</ns:countryOfOrigin>

                      <ns:sku></ns:sku>

                      <ns:netWeight>1</ns:netWeight>

                    </ns:itemDetail>

                  </ns:shipmentDetail>

                </ns:shipment>

              </ns:createShipmentRequest>
          description: ''
          name: body
          in: body
          required: true
        - name: X-RMG-Nonce
          type: string
          required: true
          in: header
          description: Base64 encoded Nonce
        - name: X-RMG-Date-Time
          type: string
          required: true
          in: header
          description: Timestamp
        - name: X-RMG-User-Name
          type: string
          required: true
          in: header
          description: This is theâ€ Web Service User Idâ€ field value in the Api Security tab on the customer maintenance screen
        - name: X-RMG-Password
          type: string
          required: true
          in: header
          format: password
          description: This is unique hashed password digest string
      responses:
        '200':
          schema: {}
          description: 200 OK
          examples:
            application/xml: >-
              <?xml version="1.0" encoding="UTF-8"?>

              <ns:createShipmentResponse
              xmlns:dt="http://www.royalmailgroup.com/cm/rmDatatypes/V1"
              xmlns:int="http://www.royalmailgroup.com/integration/core/V3"
              xmlns:ns="http://www.royalmailgroup.com/api/international/shipment/V1"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.royalmailgroup.com/api/international/shipment/V1
              InternationalShippingAPI_V1_BIG.xsd ">

                <ns:integrationHeader>

                  <ns:dateTime>2001-12-31T12:00:00</ns:dateTime>

                  <ns:applicationId>ns:applicationId</ns:applicationId>

                  <ns:transactionId>ns:transactionId</ns:transactionId>

                </ns:integrationHeader>

                <ns:completedShipment>

                  <ns:trackingNumber>ns:trackingNumber</ns:trackingNumber>

                  <ns:carrierCode>ns:carrierCode</ns:carrierCode>

                  <ns:labelImage>MA==</ns:labelImage>

                  <ns:labelImageFormat>PDF</ns:labelImageFormat>

                  <ns:globalTrackingURL>ns:globalTrackingURL</ns:globalTrackingURL>

                  <ns:localTrackingURL>ns:localTrackingURL</ns:localTrackingURL>

                </ns:completedShipment>

                <ns:integrationFooter>

                  <errors/>

                  <warnings/>

                </ns:integrationFooter>

              </ns:createShipmentResponse>
      summary: Creates an international tracked direct shipment in the system and returns a final mile carrier label.  Shipment stays in unprocessed state until confirmed by CreateBag operation.
  /bagcontent:
    post:
      description: Confirms the list of shipments created by createShipment operation. This will put the shipments in the â€˜processedâ€™ state in the system and returns the bag label and manifest for the shipments
      tags: []
      parameters:
        - schema:
            example: >-
              <?xml version="1.0" encoding="UTF-8"?>

              <ns:createBagRequest
              xmlns:dt="http://www.royalmailgroup.com/cm/rmDatatypes/V1"
              xmlns:int="http://www.royalmailgroup.com/integration/core/V3"
              xmlns:ns="http://www.royalmailgroup.com/api/international/shipment/V1"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.royalmailgroup.com/api/international/shipment/V1
              InternationalShippingAPI_V1_APIM.xsd ">

                <ns:bagContent>

                  <ns:confirmType>2</ns:confirmType>

                  <ns:carrierCode>SSYD</ns:carrierCode>

                  <ns:trackingNumber>TES100644101000930203</ns:trackingNumber>

                </ns:bagContent>

                <ns:numberOfBagLabels>1</ns:numberOfBagLabels>

                <ns:labelType>PDF</ns:labelType>

              </ns:createBagRequest>
          description: ''
          name: body
          in: body
          required: true
        - name: X-RMG-Nonce
          type: string
          required: true
          in: header
          description: Base64 encoded Nonce
        - name: X-RMG-Date-Time
          type: string
          required: true
          in: header
          description: Date/Time Stamp of Create Bag request.
        - name: X-RMG-User-Name
          type: string
          required: true
          in: header
          description: This is theâ€ Web Service User Idâ€ field value in the Api Security tab on the customer maintenance screen
        - name: X-RMG-Password
          type: string
          required: true
          in: header
          format: password
          description: This is unique hashed password digest string
      responses:
        '200':
          schema: {}
          description: 200 OK
          examples:
            application/xml: >-
              <?xml version="1.0" encoding="UTF-8"?>

              <ns:createBagResponse
              xmlns:dt="http://www.royalmailgroup.com/cm/rmDatatypes/V1"
              xmlns:int="http://www.royalmailgroup.com/integration/core/V3"
              xmlns:ns="http://www.royalmailgroup.com/api/international/shipment/V1"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.royalmailgroup.com/api/international/shipment/V1
              InternationalShippingAPI_V1_BIG.xsd ">

                <ns:integrationHeader>

                  <ns:dateTime>2001-12-31T12:00:00</ns:dateTime>

                  <ns:applicationId>ns:applicationId</ns:applicationId>

                  <ns:transactionId>ns:transactionId</ns:transactionId>

                </ns:integrationHeader>

                <ns:bagDetail>

                  <ns:manifestImage>MA==</ns:manifestImage>

                  <ns:bagLabelImage>MA==</ns:bagLabelImage>

                  <ns:bagId>ns:bagId</ns:bagId>

                </ns:bagDetail>

                <ns:integrationFooter>

                  <errors/>

                  <warnings/>

                </ns:integrationFooter>

              </ns:createBagResponse>
      summary: Processed state in the system and returns the bag label and manifest for the shipments
  '/{trackingNumber}/history':
    get:
      description: Retrieves full tracking history of a confirmed shipment
      tags: []
      parameters:
        - description: Tracking Number of shipment
          name: trackingNumber
          type: string
          required: true
          in: path
        - name: X-RMG-Nonce
          type: string
          required: true
          in: header
          description: Base64 encoded Nonce
        - name: X-RMG-Date-Time
          type: string
          required: true
          in: header
          description: Date/Time Stamp
        - name: X-RMG-User-Name
          type: string
          required: true
          in: header
          description: This is theâ€ Web Service User Idâ€ field value in the Api Security tab on the customer maintenance screen
        - name: X-RMG-Password
          type: string
          required: true
          in: header
          format: password
          description: This is unique hashed password digest string
      responses:
        '200':
          schema: {}
          description: ''
          examples:
            application/xml: >-
              <?xml version="1.0" encoding="UTF-8"?>

              <ns:trackingResponse
              xmlns:dt="http://www.royalmailgroup.com/cm/rmDatatypes/V1"
              xmlns:int="http://www.royalmailgroup.com/integration/core/V3"
              xmlns:ns="http://www.royalmailgroup.com/api/international/shipment/V1"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://www.royalmailgroup.com/api/international/shipment/V1
              InternationalShippingAPI_V1_BIG.xsd ">

                <ns:integrationHeader>

                  <ns:dateTime>2001-12-31T12:00:00</ns:dateTime>

                  <ns:applicationId>ns:applicationId</ns:applicationId>

                  <ns:transactionId>ns:transactionId</ns:transactionId>

                </ns:integrationHeader>

                <ns:trackingNumber>ns:trackingNumber</ns:trackingNumber>

                <ns:events>

                  <ns:event>

                    <ns:eventDateTime>2001-12-31T12:00:00</ns:eventDateTime>

                    <ns:eventDescription>ns:eventDescription</ns:eventDescription>

                    <ns:eventCode>ns:eventCode</ns:eventCode>

                    <ns:eventType>ns:eventType</ns:eventType>

                  </ns:event>

                </ns:events>

                <ns:integrationFooter>

                  <errors/>

                  <warnings/>

                </ns:integrationFooter>

              </ns:trackingResponse>
      summary: Retrieves full tracking history of a confirmed shipment
security:
  - Client ID: []
    Client Secret: []
consumes:
  - application/xml
  - text/xml
produces:
  - application/xml
  - text/xml
